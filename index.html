<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Kill 'Em All</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.2/socket.io.js"></script>
        <script src="https://unpkg.com/vue/dist/vue.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/4.4.3/pixi.min.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <style>
            body,
            html {
                width: 100%; height: 100%;
                margin: 0; padding: 0;
                overflow: hidden;
                background-color: #F7F7F7;
            }
            canvas { position: relative; }
        </style>
    </head>
    <body>
        <div id="app"></div>

        <script>
            var socket = io.connect(),
                tweetText, pix, scoreText,
                width = window.innerWidth,
                height = window.innerHeight;

            // get tweet from server side socket to vue app
            socket.on('tweet', function(data) {
                app.tweet = data.text;
            });

            var app = new Vue({
                el: '#app',
                data: {
                    tweet: 'Please wait for the first tweet to load',
                    tweet_count: 0,
                    score: 0,
                },
                methods: {
                    // pixi setup
                    createPixi: function() {
                        pix = new PIXI.Application(width, height, {
                            'transparent': true,
                            'autoResize': true,
                            'antialias': true
                        });
                        document.body.appendChild(pix.view);

                        // tweet text style
                        var tweetTex_style = new PIXI.TextStyle({
                            fontFamily: 'Roboto',
                            fontSize: 20,
                            fill: '#453AE4',
                            wordWrap: true,
                            wordWrapWidth: width / 4
                        });

                        // initial text value (placeholder)
                        tweetText = new PIXI.Text(this.tweet, tweetTex_style);

                        // initial text value (placeholder) position: center
                        tweetText.x = (width - tweetText.width) / 2; // horizontally center
                        tweetText.y = (height - tweetText.height) / 2; // vertically center

                        // add click event to twit
                        tweetText.on('mouseup', tweetClick);
                        // add twit to stage
                        pix.stage.addChild(tweetText);

                        // score text style
                        var scoreText_style = new PIXI.TextStyle({
                            fontFamily: 'Roboto',
                            fontSize: 12,
                            fill: '#E43E3A'
                        });

                        scoreText = new PIXI.Text(this.score, scoreText_style);

                        function tweetClick() {
                            app.tweet = '';
                            app.tweet_count--;

                            // update score
                            app.score++;
                        }
                    }
                },
                watch: {
                    // when data.tweet changes
                    'tweet': function(value) {
                        // tweetText update
                        tweetText.text = (this.tweet).toUpperCase();
                        tweetText.style.fontSize = Math.floor(Math.random() * 20) + 9;
                        this.tweet_count++; // counting total number of tweets shown

                        // random position each new tweet
                        tweet_top = Math.floor(Math.random() * (width - tweetText.width)) + 0;
                        tweet_left = Math.floor(Math.random() * (height - tweetText.height)) + 0;
                        tweetText.x = tweet_top;
                        tweetText.y = tweet_left;

                    },
                    'tweet_count': function() {
                        if (app.tweet_count == 1) {
                            // make tweet clickable
                            tweetText.interactive = true;
                            tweetText.buttonMode = true;
                        }
                        // update scoreText
                        scoreText.text = 'You burned ' + this.score + ' out of ' + this.tweet_count + ' tweets';
                    },
                    'score': function() {
                        // update scoreText
                        scoreText.text = 'You burned ' + this.score + ' out of ' + this.tweet_count + ' tweets';

                        // position score top right
                        scoreText.x = width - scoreText.width - 20;
                        scoreText.y = 20;

                        // only when score is >0 display score text
                        if (this.score == 1) {
                            pix.stage.addChild(scoreText);
                        }
                    }
                },
                mounted: function() {
                    // create pixi cavas
                    this.createPixi();
                }
            });
        </script>
    </body>
</html>
